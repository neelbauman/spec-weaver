---
name: bdd-behave-expert
description: >
  Python ç’°å¢ƒã«ãŠã‘ã‚‹ BDDï¼ˆGherkin + behaveï¼‰è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚’å°‚é–€çš„ã«æ”¯æ´ã™ã‚‹
  ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‘ã‘ã‚¹ã‚­ãƒ«å®šç¾©ã€‚
  spec-weaver ã® trace æ©Ÿèƒ½ã‚’å‰æã¨ã—ã€ä»•æ§˜ãƒ»è¨­è¨ˆãƒ»å®Ÿè£…ã‚’é€†å¼•ãã—ãªãŒã‚‰
  ã€Œã‚ã‚‹ã¹ãæŒ¯ã‚‹èˆã„ã€ã‚’ãƒ†ã‚¹ãƒˆã¨ã—ã¦å›ºå®šåŒ–ã™ã‚‹ã€‚
  ãƒ†ã‚¹ãƒˆãŒç¾åœ¨ã®å®Ÿè£…ã¨ä¹–é›¢ã—ã¦å¤±æ•—ã™ã‚‹ã“ã¨ã¯è¨­è¨ˆä¸Šæ­£å¸¸ã§ã‚ã‚Šæ­“è¿ã•ã‚Œã‚‹ã€‚
  ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œbehaveã€ã€ŒBDDãƒ†ã‚¹ãƒˆã€ã€ŒGherkinå®Ÿè£…ã€ã€Œã‚¹ãƒ†ãƒƒãƒ—å®šç¾©ã€ã€Œstepå®šç¾©ã€
  ã€Œfeatureãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè£…ã€ã€Œbehaveãƒ†ã‚¹ãƒˆã€ã€Œå—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆã€ã‚’è©±é¡Œã«ã—ãŸå ´åˆã€
  ã¾ãŸã¯æ—¢å­˜ã®featureãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾å¿œã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—å®šç¾©ã‚’æ›¸ãå ´åˆã¯å¿…ãšã“ã®ã‚¹ã‚­ãƒ«ã‚’ä½¿ã†ã“ã¨ã€‚
---

# BDDå®Ÿè£…ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚¹ã‚­ãƒ«ï¼ˆGherkin Ã— behaveï¼‰

## åŸºæœ¬å§¿å‹¢

**ãƒ†ã‚¹ãƒˆã¯ã€Œé€šã™ãŸã‚ã®ã‚‚ã®ã€ã§ã¯ãªã„ã€‚**

- ãƒ†ã‚¹ãƒˆã¯ã€Œè¨­è¨ˆã¨ã—ã¦æ­£ã—ã„ä¸–ç•Œã€ã‚’å›ºå®šã™ã‚‹ãŸã‚ã«å­˜åœ¨ã™ã‚‹
- ç¾åœ¨ã®å®Ÿè£…ãŒãƒ†ã‚¹ãƒˆã«è¿½å¾“ã§ãã¦ã„ãªã„å ´åˆã€**ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã®ã¯æ­£ã—ã„**
- ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã«åˆã‚ã›ã¦æ­ªã‚ã¦ã¯ãªã‚‰ãªã„

> ãƒ†ã‚¹ãƒˆãŒè½ã¡ã‚‹ã“ã¨ã¯å¤±æ•—ã§ã¯ãªã„
> è¨­è¨ˆã‚’è£åˆ‡ã‚‹ã“ã¨ãŒå¤±æ•—ã§ã‚ã‚‹

---

## Role

ã‚ãªãŸã¯ **Python ç’°å¢ƒã«ãŠã‘ã‚‹ BDDï¼ˆæŒ¯ã‚‹èˆã„é§†å‹•é–‹ç™ºï¼‰ã®ãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ**ã§ã‚ã‚‹ã€‚

- è¦ä»¶å®šç¾©ãƒ»ä»•æ§˜ã¯ `Gherkin (.feature)` ã«å­˜åœ¨ã™ã‚‹
- Python å®Ÿè£…ã¯ behave ã‚’ç”¨ã„ãŸ **ä»•æ§˜ç¿»è¨³å±¤** ã§ã‚ã‚‹
- ã‚ãªãŸã¯ã€Œå®Ÿè£…ã‚’æ­£å½“åŒ–ã—ãªã„ã€
- ã‚ãªãŸã¯ã€Œä»•æ§˜ã®ä»£å¼è€…ã€ã§ã‚ã‚‹

---

## çµ¶å¯¾åŸå‰‡

### 1. ä»•æ§˜è‡³ä¸Šä¸»ç¾©ï¼ˆSpecification Firstï¼‰

- å®Ÿè£…ã®éƒ½åˆã§ Gherkin ã‚’å¤‰æ›´ã—ãªã„
- ä»•æ§˜ã¨ã—ã¦æ­£ã—ã‘ã‚Œã°ã€ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¦ã‚‚ã‚ˆã„
- ä»•æ§˜ã¨å®Ÿè£…ã®ä¹–é›¢ã¯ **ãƒ†ã‚¹ãƒˆã§å¯è¦–åŒ–ã•ã‚Œã‚‹ã¹ãå•é¡Œ**

### 2. é–¢å¿ƒã®åˆ†é›¢ï¼ˆSeparation of Concernsï¼‰

- **Gherkin**: ãƒ“ã‚¸ãƒã‚¹ã®æŒ¯ã‚‹èˆã„ï¼ˆWhatï¼‰
- **Step**: ç¿»è¨³ã¨å§”è­²ã®ã¿ï¼ˆHowï¼‰
- ãƒ­ã‚¸ãƒƒã‚¯ãƒ»åˆ¤æ–­ãƒ»è¨ˆç®—ã¯ Step ã«æ›¸ã‹ãªã„

> Step ã¯è³¢ããªã‚‹ãª
> è³¢ã•ã¯å¤–ã«é€ƒãŒã›

### 3. å®£è¨€çš„è¨˜è¿°ï¼ˆDeclarative Firstï¼‰

- Gherkin ã« UIãƒ»APIãƒ»DB ã®å®Ÿè£…è©³ç´°ã‚’æ›¸ã‹ãªã„
- ãƒ‰ãƒ¡ã‚¤ãƒ³ç”¨èªãƒ»æ¥­å‹™ç”¨èªã‚’æœ€å„ªå…ˆã™ã‚‹
- ãƒ†ã‚¹ãƒˆã¯ã€Œæ“ä½œèª¬æ˜æ›¸ã€ã§ã¯ãªã„

---

## spec-weaver trace ã«ã‚ˆã‚‹æƒ…å ±åé›†ï¼ˆå¿…é ˆï¼‰

ãƒ†ã‚¹ãƒˆã‚’æ›¸ãå‰ã«ã€å¿…ãš spec-weaver trace ã§ä»•æ§˜ãƒ»è¨­è¨ˆãƒ»å®Ÿè£…ã®é–¢é€£æƒ…å ±ã‚’åé›†ã™ã‚‹ã“ã¨ã€‚

```bash
# å¯¾è±¡ SPEC ã‚’èµ·ç‚¹ã«é–¢é€£æƒ…å ±ã‚’ã™ã¹ã¦å±•é–‹ã™ã‚‹
uv run spec-weaver trace SPEC-xxx -f ./specification/features --show-impl

# .feature ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èµ·ç‚¹ã«ç´ã¥ã SPEC/REQ ã‚’é¡ã‚‹
uv run spec-weaver trace target.feature -f ./specification/features --direction up

# å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªï¼ˆ--show-impl ã§ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãå®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚è¡¨ç¤ºï¼‰
uv run spec-weaver trace SPEC-xxx -f ./specification/features --show-impl --extensions py
```

### trace çµæœã®ä½¿ã„æ–¹

| åé›†å¯¾è±¡ | ç”¨é€” |
|---|---|
| è¦ª REQ | ã€Œãªãœã“ã®æŒ¯ã‚‹èˆã„ãŒå¿…è¦ã‹ã€ã®æ–‡è„ˆæŠŠæ¡ |
| å¯¾è±¡ SPEC | ãƒ†ã‚¹ãƒˆãŒè¨¼æ˜ã™ã¹ãä»•æ§˜ã®æœ¬æ–‡ |
| ãƒªãƒ³ã‚¯ã•ã‚ŒãŸ `.feature` | æ—¢å­˜ã‚·ãƒŠãƒªã‚ªã¨ã®é‡è¤‡ãƒ»è£œå®Œé–¢ä¿‚ã®ç¢ºèª |
| `ğŸ“` `ğŸ“` å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ« | ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³ã®æŠŠæ¡ï¼ˆãŸã ã—ä»•æ§˜ã«å¾“ã‚ã›ã‚‹ï¼‰ |

**é‡è¦**: trace çµæœã«åˆã‚ã›ã¦ä»•æ§˜ã‚’æ­ªã‚ã¦ã¯ãªã‚‰ãªã„ã€‚
ä»•æ§˜ã«åã™ã‚‹å®Ÿè£…ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã€ãã®ä¹–é›¢ã‚’ **ãƒ†ã‚¹ãƒˆå¤±æ•—ã¨ã—ã¦å›ºå®šåŒ–ã™ã‚‹**ã€‚

è©³ç´°ã¯ `references/spec-weaver-trace-workflow.md` ã‚’å‚ç…§ã€‚

---

## Gherkin (.feature) è¨˜è¿°ãƒ«ãƒ¼ãƒ«

- Gherkin v6 ã«æº–æ‹ ã™ã‚‹ï¼ˆRule ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ´»ç”¨ï¼‰
- Feature ã¯ã€Œæ¥­å‹™ä¸Šã®é–¢å¿ƒäº‹ã€å˜ä½ã§å®šç¾©ã™ã‚‹
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã¯ `Rule` ã§æ˜ç¤ºã™ã‚‹
- å…±é€šå‰æã¯ `Background` ã«é›†ç´„ã™ã‚‹

### ãƒ‡ãƒ¼ã‚¿è¡¨ç¾ãƒ«ãƒ¼ãƒ«

| ç”¨é€” | æ§‹æ–‡ |
|---|---|
| è¤‡æ•°ãƒ¬ã‚³ãƒ¼ãƒ‰ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ | Data Table |
| å¢ƒç•Œå€¤ãƒ»ç¶²ç¾…çš„ãªãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ | Scenario Outline + Examples |
| é•·æ–‡ã®æœŸå¾…å€¤ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | Doc String (`"""`) |

- æ„å‘³ã®ç•°ãªã‚‹ Examples ã‚’1ã¤ã«ã¾ã¨ã‚ãªã„
- Examples åã¯ã€Œæ¥­å‹™çš„ãªæ„å‘³ã€ã‚’æŒãŸã›ã‚‹

### Featureãƒ•ã‚¡ã‚¤ãƒ«ã¨ SPEC ã®ãƒªãƒ³ã‚¯

```gherkin
@SPEC-001
Feature: ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆã®æŒ¯ã‚‹èˆã„
```

- Feature ã‚¿ã‚°ã« `@SPEC-xxx` ã‚’ä»˜ä¸ã—ã¦ Doorstop ã¨ãƒªãƒ³ã‚¯ã•ã›ã‚‹
- spec-weaver audit ã§ãƒªãƒ³ã‚¯æ•´åˆæ€§ã‚’ç¢ºèªã§ãã‚‹

---

## behave (Python) å®Ÿè£…ãƒ«ãƒ¼ãƒ«

### Thin Wrapper åŸå‰‡ï¼ˆçµ¶å¯¾ï¼‰

Step é–¢æ•°ã¯ **å§”è­²ã®ã¿**ã€‚ä»¥ä¸‹ã‚’ **ç¦æ­¢** ã™ã‚‹ã€‚

- `if` / `for` / `while`
- æ¡ä»¶åˆ†å²
- è¨ˆç®—ãƒ»å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®å†å®Ÿè£…
- ä»•æ§˜ã®å†è§£é‡ˆ

### è¨±å¯ã•ã‚Œã‚‹ Step ã®è²¬å‹™

1. Gherkin ã‹ã‚‰å€¤ã‚’å—ã‘å–ã‚‹
2. `context.xxx` ã«ãã®ã¾ã¾æ¸¡ã™
3. çµæœã‚’ `assert` ã§æ¯”è¼ƒã™ã‚‹

### ãƒ‡ãƒ¼ã‚¿å—ã‘å–ã‚Šã®æ­£è¦ãƒ«ãƒ¼ãƒˆ

| ãƒ‡ãƒ¼ã‚¿å½¢å¼ | å—ã‘å–ã‚Šæ–¹ |
|---|---|
| å˜ä¸€ã®å€¤ | å‹ä»˜ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ `{count:d}`, `{name}` |
| è¤‡æ•°ãƒ¬ã‚³ãƒ¼ãƒ‰ | `context.table` |
| é•·æ–‡ãƒ†ã‚­ã‚¹ãƒˆ | `context.text` |

**æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹ç‹¬è‡ªãƒ‘ãƒ¼ã‚¹ã¯ç¦æ­¢ã€‚** å‹ä»˜ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨å…¬å¼æ§‹æ–‡ã‚’ä½¿ã†ã“ã¨ã€‚

è©³ç´°ã¯ `references/behave-patterns.md` ã‚’å‚ç…§ã€‚

---

## Anti-Patternsï¼ˆç¦æ­¢äº‹é …ï¼‰

| ç¦æ­¢ | ç†ç”± |
|---|---|
| ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ä»•æ§˜ã‚’å¼±ã‚ã‚‹ | è¨­è¨ˆã®è£åˆ‡ã‚Š |
| Step ã« `if` / `for` ã‚’æ›¸ã | ãƒ­ã‚¸ãƒƒã‚¯ã®æ··å…¥ |
| å®Ÿè£…ã®éƒ½åˆã‚’ Gherkin ã«æŒã¡è¾¼ã‚€ | é–¢å¿ƒã®é€†è»¢ |
| å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å‰Šé™¤ã™ã‚‹ | è¨­è¨ˆã®æ„æ€ã®æ¶ˆæ»… |
| `context` ã«ä¸­é–“è¨ˆç®—çµæœã‚’è©°ã‚è¾¼ã‚€ | Step ã®è²¬å‹™è¶…é |
| Step é–¢æ•°ã‚’å…±æœ‰ã—ã™ãã‚‹ | æš—é»™ã®ä¾å­˜ |

---

## å®Ÿè£…ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### Step 1: trace ã§æƒ…å ±åé›†ã™ã‚‹

```bash
uv run spec-weaver trace SPEC-xxx -f ./specification/features --show-impl
```

Doorstop YAML ã® `text` ã‚’èª­ã¿ã€ã€Œã‚ã‚‹ã¹ãæŒ¯ã‚‹èˆã„ã€ã‚’ç¢ºèªã™ã‚‹ã€‚

### Step 2: `.feature` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­è¨ˆã™ã‚‹

ä»•æ§˜ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ»å®Ÿè£…ç„¡è¦–ã§ Feature / Scenario ã‚’æ›¸ãã€‚
`@SPEC-xxx` ã‚¿ã‚°ã‚’ä»˜ã‘ã¦ Doorstop ã¨ãƒªãƒ³ã‚¯ã•ã›ã‚‹ã€‚

### Step 3: scaffold ã§é››å½¢ã‚’ç”Ÿæˆã™ã‚‹ï¼ˆå¿…é ˆï¼‰

**`.feature` ã‚’æ›¸ã„ãŸã‚‰ã€å¿…ãšæœ€åˆã« `spec-weaver scaffold` ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã€‚**
æ‰‹ã§ã‚¼ãƒ­ã‹ã‚‰ Step å®šç¾©ã‚’æ›¸ãå§‹ã‚ã¦ã¯ãªã‚‰ãªã„ã€‚

```bash
uv run spec-weaver scaffold ./specification/features --out-dir features/steps
```

ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«: `features/steps/step_<featureå>.py`

ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®ç‰¹å¾´:
- å„ Step ã¯ `raise NotImplementedError('STEP: ...')` ã‚’æœ¬ä½“ã¨ã™ã‚‹é››å½¢
- `"quoted string"` ã¯è‡ªå‹•çš„ã« `{param0}`, `{param1}` ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã•ã‚Œã‚‹
- ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©æ¸ˆã¿ã® Step ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã¦ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
- é–¢æ•°åã¯ Step æ–‡ã® SHA256 ãƒãƒƒã‚·ãƒ¥ï¼ˆé ASCII æ–‡å­—ã‚’é¿ã‘ã‚‹ãŸã‚ï¼‰

æ—¢å­˜ã® Step ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†ç”Ÿæˆã—ãŸã„å ´åˆ:
```bash
uv run spec-weaver scaffold ./specification/features --out-dir features/steps --overwrite
```

### Step 4: é››å½¢ã‚’ä»•æ§˜ã«å¾“ã£ã¦è‚‰ä»˜ã‘ã™ã‚‹

`raise NotImplementedError` ã‚’ `context.xxx` ã¸ã®å§”è­²ã¨ `assert` ã«ç½®ãæ›ãˆã‚‹ã€‚
ã“ã®ã¨ã scaffold ãŒç”Ÿæˆã—ãŸå‹ãªã—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ `{param0}` ã‚’ã€
ä»•æ§˜ã®æ„å‘³ã«åˆã‚ã›ãŸå‹ä»˜ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ`{count:d}` ç­‰ï¼‰ã¸ä¿®æ­£ã™ã‚‹ã€‚

```python
# scaffold ãŒç”Ÿæˆã—ãŸé››å½¢
@when('ã‚«ãƒ¼ãƒˆã« "{param0}" ã‚’è¿½åŠ ã™ã‚‹')  # type: ignore
def when_a1b2c3d4(context, param0):
    """ã‚«ãƒ¼ãƒˆã« "é«˜ç´šã‚¤ãƒ¤ãƒ›ãƒ³" ã‚’è¿½åŠ ã™ã‚‹"""
    raise NotImplementedError('STEP: ã‚«ãƒ¼ãƒˆã« "{param0}" ã‚’è¿½åŠ ã™ã‚‹')

# â†“ ä»•æ§˜ã«åˆã‚ã›ã¦è‚‰ä»˜ã‘ã™ã‚‹
@when('ã‚«ãƒ¼ãƒˆã« {count:d} å€‹ã® "{item}" (å˜ä¾¡: {price:d}å††) ã‚’è¿½åŠ ã™ã‚‹')
def step_impl(context, count, item, price):
    context.api_client.add_items_to_cart(name=item, unit_price=price, quantity=count)
```

Step ã¯ã€Œ1æ–‡ = 1å§”è­²ã€ã«åˆ†è§£ã™ã‚‹ã€‚ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’å‰æã«å®Œäº†ã¨ã™ã‚‹ã€‚

### Step 5: audit ã§ãƒªãƒ³ã‚¯æ•´åˆæ€§ã‚’ç¢ºèªã™ã‚‹

```bash
uv run spec-weaver audit ./specification/features
```

---

## å®Œå…¨å®Ÿè£…ä¾‹

### Gherkin Feature

`specification/features/checkout.feature`

```gherkin
@SPEC-010
Feature: ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆã¨æ±ºæ¸ˆã®åˆ¶å¾¡

  Background:
    Given ã‚·ã‚¹ãƒ†ãƒ ã«ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹:
      | username | status |
      | alice    | VIP    |
      | bob      | NORMAL |

  Rule: VIPãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä¸€å®šé‡‘é¡ä»¥ä¸Šã§é€æ–™ç„¡æ–™ã«ãªã‚‹

    Scenario Outline: VIPãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³¼å…¥é‡‘é¡åˆ¥é€æ–™
      Given ãƒ¦ãƒ¼ã‚¶ãƒ¼ "alice" ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹
      When ã‚«ãƒ¼ãƒˆã« <å“æ•°> å€‹ã® "é«˜ç´šã‚¤ãƒ¤ãƒ›ãƒ³" (å˜ä¾¡: <å˜ä¾¡>å††) ã‚’è¿½åŠ ã™ã‚‹
      Then é€æ–™ã¯ <é€æ–™> å††ã«ãªã‚‹ã“ã¨

      Examples: é€šå¸¸é€æ–™
        | å“æ•° | å˜ä¾¡ | é€æ–™ |
        | 1    | 5000 | 500  |

      Examples: é€æ–™ç„¡æ–™ãƒ©ã‚¤ãƒ³åˆ°é”
        | å“æ•° | å˜ä¾¡ | é€æ–™ |
        | 2    | 5000 | 0    |
```

### Python Step å®šç¾©

`features/steps/checkout_steps.py`

```python
from behave import given, when, then


@given('ã‚·ã‚¹ãƒ†ãƒ ã«ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹:')
def step_impl(context):
    users = [
        {"username": row["username"], "status": row["status"]}
        for row in context.table
    ]
    context.api_client.setup_users(users)


@given('ãƒ¦ãƒ¼ã‚¶ãƒ¼ "{username}" ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹')
def step_impl(context, username):
    context.api_client.login(username)


@when('ã‚«ãƒ¼ãƒˆã« {count:d} å€‹ã® "{item}" (å˜ä¾¡: {price:d}å††) ã‚’è¿½åŠ ã™ã‚‹')
def step_impl(context, count, item, price):
    context.api_client.add_items_to_cart(
        name=item,
        unit_price=price,
        quantity=count,
    )


@then('é€æ–™ã¯ {expected:d} å††ã«ãªã‚‹ã“ã¨')
def step_impl(context, expected):
    actual = context.api_client.calculate_shipping()
    assert actual == expected
```

### `context.xxx` ã®ä½ç½®ã¥ã‘

| ãƒ†ã‚¹ãƒˆç¨®åˆ¥ | `context.xxx` ã«è¨­å®šã™ã‚‹ã‚‚ã® |
|---|---|
| UI ãƒ†ã‚¹ãƒˆ | Page Object / Screen Object |
| API ãƒ†ã‚¹ãƒˆ | HTTP Client / SDK Wrapper |
| çµåˆãƒ†ã‚¹ãƒˆ | Service Facade / Fixture |

Step å®šç¾©ã¯ãã®å†…éƒ¨å®Ÿè£…ã‚’ä¸€åˆ‡çŸ¥ã‚‰ãªã„ã€‚

---

## å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | èª­ã‚€ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|---|---|
| `references/behave-patterns.md` | Step å®šç¾©ã®å…·ä½“çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºèªã™ã‚‹ã¨ã |
| `references/spec-weaver-trace-workflow.md` | trace ã§ã©ã†æƒ…å ±ã‚’é›†ã‚ã¦ãƒ†ã‚¹ãƒˆè¨­è¨ˆã™ã‚‹ã‹ç¢ºèªã™ã‚‹ã¨ã |

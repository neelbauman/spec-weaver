# Spec-Weaverã®ä½¿ã„æ–¹

## ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

| ã‚³ãƒãƒ³ãƒ‰ | æ¦‚è¦ |
|---|---|
| `audit` | ä»•æ§˜ã¨Gherkinã‚¿ã‚°ã®ä¹–é›¢ã‚’æ¤œçŸ¥ï¼ˆCIé€£æºå‘ã‘ï¼‰ |
| `status` | å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ä¸€è¦§ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°è¡¨ç¤º |
| `build` | ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ»ãƒ†ã‚¹ãƒˆçµæœçµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆã®ç”Ÿæˆ |
| `trace` | ä»»æ„ã‚¢ã‚¤ãƒ†ãƒ ã‚’èµ·ç‚¹ã¨ã—ãŸãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ãƒ„ãƒªãƒ¼è¡¨ç¤º |

---

## 1. ä»•æ§˜ã¨ãƒ†ã‚¹ãƒˆã®ç´ä»˜ã‘ãƒ«ãƒ¼ãƒ«

Doorstopã®ä»•æ§˜æ›¸ï¼ˆYAMLï¼‰ã§ç™ºç•ªã•ã‚ŒãŸIDã‚’ã€Gherkinï¼ˆ`.feature`ï¼‰ã® **ã‚¿ã‚°** ã¨ã—ã¦è¨˜è¿°ã™ã‚‹ã“ã¨ã§ä¸¡è€…ã‚’ç´ä»˜ã‘ã¾ã™ã€‚

**Doorstopå´ (`specs/SPEC-001.yml`)**

```yaml
active: true
testable: true
links:
- REQ-001
text: |
  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ä¿å­˜ã™ã‚‹ã“ã¨ã€‚
```

**Gherkinå´ (`features/login.feature`)**

```gherkin
@SPEC-001
Feature: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
  Scenario: æ­£ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã®ãƒ­ã‚°ã‚¤ãƒ³
    Given ...
```

---

## 2. `audit` ã‚³ãƒãƒ³ãƒ‰ â€” ä»•æ§˜ã¨ãƒ†ã‚¹ãƒˆã®ä¹–é›¢æ¤œçŸ¥

```bash
# åŸºæœ¬çš„ãªå®Ÿè¡Œï¼ˆã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã¨ã™ã‚‹å ´åˆï¼‰
spec-weaver audit ./features

# ãƒ¢ãƒãƒ¬ãƒç’°å¢ƒãªã©ã§Doorstopã®ãƒ«ãƒ¼ãƒˆãŒåˆ¥ã«ã‚ã‚‹å ´åˆ
spec-weaver audit ./backend/tests/features --repo-root ./docs/doorstop

# ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’é™å®šã™ã‚‹å ´åˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å…¨ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰
spec-weaver audit ./features --prefix REQ
```

**çµ‚äº†ã‚³ãƒ¼ãƒ‰**: 0ï¼ˆä¹–é›¢ãªã—ï¼‰/ 1ï¼ˆä¹–é›¢ã‚ã‚Šã€ã¾ãŸã¯Suspectæ¤œå‡ºï¼‰

ä¹–é›¢ãŒã‚ã‚‹å ´åˆã®å‡ºåŠ›ä¾‹ï¼š

```
âŒ ãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ä»•æ§˜ (Untested Specs):
  SPEC-002

âš ï¸ ä»•æ§˜æ›¸ã«å­˜åœ¨ã—ãªã„å­¤å…ã‚¿ã‚° (Orphaned Tags):
  @SPEC-003

âš ï¸ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ãªSuspectä»•æ§˜:
  SPEC-004  ä¸Šä½è¦ä»¶ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã§ã™ã€‚
```

---

## 3. `status` ã‚³ãƒãƒ³ãƒ‰ â€” å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†

Doorstopã®YAMLã« `status` ã‚«ã‚¹ã‚¿ãƒ å±æ€§ã‚’è¿½è¨˜ã—ã¦å®Ÿè£…é€²æ—ã‚’ç®¡ç†ã—ã¾ã™ã€‚

```yaml
# SPEC-001.yml ã«è¿½è¨˜
status: in-progress
```

åˆ©ç”¨å¯èƒ½ãªå€¤: `draft` / `in-progress` / `implemented` / `deprecated`

```bash
# å…¨ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€è¦§
spec-weaver status

# ç‰¹å®šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§çµã‚Šè¾¼ã¿
spec-weaver status --filter in-progress
spec-weaver status --filter draft
```

---

## 4. `build` ã‚³ãƒãƒ³ãƒ‰ â€” Living Documentationã‚µã‚¤ãƒˆç”Ÿæˆ

ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ»ç›¸äº’ãƒªãƒ³ã‚¯ãƒ»ãƒ†ã‚¹ãƒˆçµæœã‚’çµ±åˆã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash
# åŸºæœ¬çš„ãªå®Ÿè¡Œ
spec-weaver build ./specification/features --out-dir .specification

# Cucumberäº’æ›ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœï¼ˆJSONï¼‰ã‚’çµ„ã¿è¾¼ã‚€å ´åˆ
spec-weaver build ./specification/features --out-dir .specification \
    --test-results test-results.json

# MkDocsã§ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤º
mkdocs serve -f .specification/mkdocs.yml
```

**ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„:**

| ãƒšãƒ¼ã‚¸ | å†…å®¹ |
|---|---|
| `<prefix>.md` | å„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¸€è¦§è¡¨ï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ»å®Ÿè£…çŠ¶æ³ãƒ»ç›¸äº’ãƒªãƒ³ã‚¯ä»˜ãï¼‰ |
| `items/REQ-001.md` | è¦ä»¶è©³ç´°ï¼ˆé–¢é€£ä»•æ§˜ãƒ»å…„å¼Ÿè¦ä»¶ãƒ»é›†è¨ˆã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰ |
| `items/SPEC-001.md` | ä»•æ§˜è©³ç´°ï¼ˆé–¢é€£è¦ä»¶ãƒ»å…„å¼Ÿä»•æ§˜ãƒ»ã‚·ãƒŠãƒªã‚ªãƒªãƒ³ã‚¯ï¼‰ |
| `features/xxx.md` | `.feature` ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§èª­ã‚ã‚‹Markdownã«å¤‰æ›ã—ãŸãƒšãƒ¼ã‚¸ |

**ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒãƒƒã‚¸ã®è¦‹æ–¹:**

- `ğŸŸ¢ 1/1 (100%)` â€” å…¨ã‚·ãƒŠãƒªã‚ªã‚«ãƒãƒ¼æ¸ˆã¿
- `ğŸŸ¡ 2/4 (50%)` â€” ä¸€éƒ¨ã‚«ãƒãƒ¼æ¸ˆã¿
- `ğŸ”´ 0/3 (0%)` â€” æœªã‚«ãƒãƒ¼
- `âšªï¸ -` â€” ãƒ†ã‚¹ãƒˆå¯¾è±¡å¤–ï¼ˆ`testable: false`ï¼‰

**`--test-results` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆCucumber JSONï¼‰:**

pytest-bdd ãªã©ãŒå‡ºåŠ›ã™ã‚‹ Cucumber äº’æ› JSON ã‚’æŒ‡å®šã™ã‚‹ã¨ã€å„ã‚·ãƒŠãƒªã‚ªã«å®Ÿè¡Œçµæœãƒãƒƒã‚¸ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚

```json
[
  {
    "uri": "features/login.feature",
    "elements": [
      {
        "name": "æ­£ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã®ãƒ­ã‚°ã‚¤ãƒ³",
        "steps": [{"result": {"status": "passed"}}, ...]
      }
    ]
  }
]
```

ãƒãƒƒã‚¸: `âœ… PASS` / `âŒ FAIL` / `â­ï¸ SKIP` / `â³ PENDING`

---

## 5. `trace` ã‚³ãƒãƒ³ãƒ‰ â€” ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ãƒ„ãƒªãƒ¼è¡¨ç¤º

ä»»æ„ã®ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆREQ / SPEC / `.feature` ãƒ•ã‚¡ã‚¤ãƒ«åï¼‰ã‚’èµ·ç‚¹ã¨ã—ã¦ã€ä¸Šä½è¦ä»¶ã€œä¸‹ä½ä»•æ§˜ã€œGherkinã‚·ãƒŠãƒªã‚ªã‚’éšå±¤ãƒ„ãƒªãƒ¼ã§å¯è¦–åŒ–ã—ã¾ã™ã€‚

```bash
# REQã‚’èµ·ç‚¹ã«å…¨å­å­«ã‚’å±•é–‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: both = ä¸Šä½+ä¸‹ä½ï¼‰
spec-weaver trace REQ-001 -f ./specification/features

# SPECã‚’èµ·ç‚¹ã«ä¸Šä½REQ + ä¸‹ä½ã‚·ãƒŠãƒªã‚ªã‚’è¡¨ç¤ºï¼ˆbothï¼‰
spec-weaver trace SPEC-003 -f ./specification/features

# .featureãƒ•ã‚¡ã‚¤ãƒ«ã‚’èµ·ç‚¹ã«ç´ã¥ãSPEC/REQã‚’é¡ã‚‹ï¼ˆupï¼‰
spec-weaver trace audit.feature -f ./specification/features --direction up

# æ–¹å‘ã®æŒ‡å®š
spec-weaver trace REQ-001 --direction down   # ä¸‹ä½ã®ã¿ï¼ˆGherkinå«ã‚€ï¼‰
spec-weaver trace SPEC-003 --direction up    # ä¸Šä½ã®ã¿ï¼ˆã‚·ãƒŠãƒªã‚ªãªã—ï¼‰

# ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§å‡ºåŠ›
spec-weaver trace REQ-001 -f ./specification/features --format flat
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³:**

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | çŸ­ç¸® | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|---|---|---|---|
| `--feature-dir` | `-f` | ãªã— | `.feature` ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆGherkinè¡¨ç¤ºã«å¿…è¦ï¼‰ |
| `--repo-root` | `-r` | ã‚«ãƒ¬ãƒ³ãƒˆ | Doorstopãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆ |
| `--direction` | `-d` | `both` | `up` / `down` / `both` |
| `--format` | | `tree` | `tree`ï¼ˆRich Treeï¼‰/ `flat`ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ |

**ãƒ„ãƒªãƒ¼å‡ºåŠ›ä¾‹ï¼ˆ`SPEC-003` ã‚’èµ·ç‚¹ã€`both`ï¼‰:**

```
REQ-001 ä»•æ§˜ã¨å®Ÿè£…ã®ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ä¿è¨¼ âœ… implemented
â””â”€â”€ REQ-002 ç›£æŸ»ã«ã‚ˆã‚‹å“è³ªã®ç¶™ç¶šçš„æ‹…ä¿ âœ… implemented
    â””â”€â”€ â˜… SPEC-003 audit ã‚³ãƒãƒ³ãƒ‰ä»•æ§˜ âœ… implemented
        â””â”€â”€ ğŸ¥’ audit.feature
            â””â”€â”€ Scenario: audit ã‚³ãƒãƒ³ãƒ‰
```

**ãƒ„ãƒªãƒ¼å‡ºåŠ›ä¾‹ï¼ˆ`REQ-001` ã‚’èµ·ç‚¹ã€`down`ï¼‰:**

```
â˜… REQ-001 ä»•æ§˜ã¨å®Ÿè£…ã®ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ä¿è¨¼ âœ… implemented
â”œâ”€â”€ REQ-002 ç›£æŸ»ã«ã‚ˆã‚‹å“è³ªã®ç¶™ç¶šçš„æ‹…ä¿ âœ… implemented
â”‚   â”œâ”€â”€ SPEC-002 ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºåŸºç›¤ âœ… implemented
â”‚   â”‚   â””â”€â”€ ğŸ¥’ data_extraction.feature
â”‚   â”‚       â””â”€â”€ Scenario: ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºåŸºç›¤
â”‚   â””â”€â”€ SPEC-003 audit ã‚³ãƒãƒ³ãƒ‰ä»•æ§˜ âœ… implemented
â”‚       â””â”€â”€ ğŸ¥’ audit.feature
â”‚           â””â”€â”€ Scenario: audit ã‚³ãƒãƒ³ãƒ‰
â””â”€â”€ SPEC-001 ã‚³ã‚¢ãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ âœ… implemented
```

**è¡¨ç¤ºè¨˜å·:**

| è¨˜å· | æ„å‘³ |
|---|---|
| `â˜…` | æ¢ç´¢èµ·ç‚¹ã®ã‚¢ã‚¤ãƒ†ãƒ ï¼ˆé»„è‰²å¤ªå­—ã§å¼·èª¿è¡¨ç¤ºï¼‰ |
| `ğŸ¥’` | é–¢é€£ã™ã‚‹Gherkin `.feature` ãƒ•ã‚¡ã‚¤ãƒ« |
| `Scenario: ...` | `.feature` å†…ã®ã‚·ãƒŠãƒªã‚ªå |

**èµ·ç‚¹ã®ç¨®é¡:**

- `REQ-001` â€” Doorstop IDã§ç›´æ¥æŒ‡å®š
- `SPEC-003` â€” Doorstop IDã§ç›´æ¥æŒ‡å®š
- `audit.feature` â€” ãƒ•ã‚¡ã‚¤ãƒ«åã§æŒ‡å®šï¼ˆå†…éƒ¨ã§ã‚¿ã‚°ã‚’é€†å¼•ãã—ã¦SPEC IDã‚’è§£æ±ºï¼‰

---

## âš™ï¸ é«˜åº¦ãªè¨­å®š

### ãƒ†ã‚¹ãƒˆå¯¾è±¡å¤–ã®ä»•æ§˜

Gherkinã§ã®æŒ¯ã‚‹èˆã„ãƒ†ã‚¹ãƒˆãŒä¸å¯èƒ½ãªä»•æ§˜ã¯ `testable: false` ã‚’è¿½è¨˜ã—ã¦ç›£æŸ»å¯¾è±¡ã‹ã‚‰é™¤å¤–ã—ã¾ã™ã€‚

```yaml
# SPEC-005.yml
active: true
testable: false
text: |
  ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®èƒŒæ™¯è‰²ã¯é’è‰²ã¨ã™ã‚‹ã“ã¨ã€‚
```

### å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°æ‰‹é †

1. å¯¾è±¡YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã `status: <å€¤>` ã‚’è¿½è¨˜ãƒ»æ›´æ–°ã™ã‚‹
2. `spec-weaver status --filter <å€¤>` ã§å¤‰æ›´ã‚’ç¢ºèªã™ã‚‹
3. å¿…è¦ã«å¿œã˜ã¦ `spec-weaver build` ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å†ç”Ÿæˆã™ã‚‹

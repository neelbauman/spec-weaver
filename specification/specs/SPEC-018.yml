active: true
derived: false
header: |
  コードアノテーションスキャンによる実装ファイル検出
impl_files:
- src/spec_weaver/impl_scanner.py
level: 18.0
links:
- REQ-012: W1M-g8bMakjNSi3dVoSS2rEjVb7A3bfA2f3UYepGHok=
normative: true
ref: ''
reviewed: IEDfYR9Ce9sTaNWfNob1qIfM31YLn8AR3pvQu6xXj_4=
status: implemented
testable: true
text: |
  ## 概要
  ソースファイルに記述されたアノテーション（`# implements: SPEC-001` 等）を
  スキャンし、仕様IDと実装ファイルの対応を自動抽出する機能を提供する。

  ## 詳細仕様

  ### アノテーション書式
  ソースファイル内の任意の行に以下の形式で記述する。

  ```python
  # implements: SPEC-001
  # implements: SPEC-001, SPEC-002
  # implements: SPEC-001, REQ-012
  ```

  - コメント記号（`#`, `//`, `--` 等）の後に `implements:` キーワード
  - スペースで区切り、仕様IDをカンマ区切りで列挙
  - 複数IDの記述を許容する
  - アノテーションのないファイルは警告なしとして扱う（エラーでない）

  ### スキャン対象
  - デフォルト: リポジトリ内の全テキストファイル
  - `--extensions` オプション: 拡張子でフィルタリング可能（例: `--extensions py,ts,tsx`）
  - `.gitignore` 相当のパターンは除外対象とする（`.git/`, `__pycache__/` 等）

  ### 出力データ構造
  スキャン結果は「仕様ID → ファイルパスのセット」のマッピングとして保持する。

  ```python
  # 例
  {
      "SPEC-001": {"src/spec_weaver/cli.py", "src/spec_weaver/doorstop.py"},
      "SPEC-018": {"src/spec_weaver/impl_scanner.py"},
  }
  ```

  ### 実装モジュール
  `src/spec_weaver/impl_scanner.py` に `ImplScanner` クラスとして実装する。

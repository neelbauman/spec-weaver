active: true
derived: false
header: |
  å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ³ã‚¯ç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£…è¨ˆç”»
level: 1.0
links:
- SPEC-017: A76g43OkIi2CSzjgCsf6eLKXl-T3rDYl1Y43xyiW-AU=
- SPEC-018: KiALrkjdny34oU1P2pPkAC53wjEvznAyP2TYcxjxhnY=
- SPEC-019: azjeoL4K9UsQcFovSwUyLqeIMVQ-tU35MSwmDiRQMQc=
- SPEC-020: 4CXi5pU-qZ42cEYDV5ApDZV2SiAJuFpTXV3fU8-oLpU=
normative: true
ref: ''
reviewed: u5JY3UQqHlgKW2pR0J-huPTkom_JsQmc2zFS89jV_bo=
status: implemented
testable: false
text: |
  ## æ¦‚è¦
  ä»•æ§˜ã‚¢ã‚¤ãƒ†ãƒ ã¨å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒ³ã‚¯ç®¡ç†æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹è¨ˆç”»ã€‚
  SPEC-017ã€œ020 ã«å¯¾å¿œã™ã‚‹ã€‚

  ## å®Ÿè£…ã‚¿ã‚¹ã‚¯ï¼ˆå®Ÿè¡Œé †ï¼‰

  ### Task 1: impl_scanner.py ã®æ–°è¦ä½œæˆï¼ˆSPEC-017, SPEC-018ï¼‰
  **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/spec_weaver/impl_scanner.py`
  **å†…å®¹**:
  - `get_ref_files(item) -> list[str]`:
    ref ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’èª­ã¿å–ã‚Šã€æ–‡å­—åˆ—ãƒ»ãƒªã‚¹ãƒˆãƒ»ç©ºæ–‡å­—ã‚’çµ±ä¸€çš„ã«å‡¦ç†ã—ã¦è¿”ã™
  - `ImplScanner` ã‚¯ãƒ©ã‚¹:
    - `scan(repo_root, extensions=None) -> dict[str, set[str]]`
      æ­£è¦è¡¨ç¾ `r'(?:#|//|--)\s*implements:\s*(.+)'` ã§ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŠ½å‡º
      `.git/`, `__pycache__/`, `.venv/` ç­‰ã‚’é™¤å¤–
      extensions ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆã¯ãã®æ‹¡å¼µå­ã®ã¿å¯¾è±¡

  ### Task 2: doorstop.py ã¸ã® ref èª­ã¿å–ã‚Šé–¢æ•°è¿½åŠ ï¼ˆSPEC-017ï¼‰
  **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/spec_weaver/doorstop.py`
  **å†…å®¹**:
  - impl_scanner.py ã« get_ref_files ã‚’é›†ç´„ã™ã‚‹ãŸã‚ doorstop.py ã¸ã®è¿½åŠ ã¯æœ€å°é™ã¨ã™ã‚‹
  - get_item_map ã® import ã‚’ impl_scanner ã‹ã‚‰å‘¼ã¹ã‚‹ã‚ˆã†æ•´ç†

  ### Task 3: audit ã‚³ãƒãƒ³ãƒ‰ã®æ‹¡å¼µï¼ˆSPEC-019ï¼‰
  **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/spec_weaver/cli.py`
  **è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
  - `--check-impl` (bool, default: False): å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ³ã‚¯æ¤œè¨¼ã‚’æœ‰åŠ¹åŒ–
  - `--extensions TEXT` (str, default: None): ã‚¹ã‚­ãƒ£ãƒ³æ‹¡å¼µå­ã®ã‚«ãƒ³ãƒåŒºåˆ‡ã‚ŠæŒ‡å®š
  **å‡¦ç†ãƒ•ãƒ­ãƒ¼**ï¼ˆ--check-impl æ™‚ï¼‰:
  1. get_item_map ã§å…¨ SPEC ã® ref ã‚’åé›†
  2. ImplScanner.scan() ã§ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åé›†
  3. 3ç¨®ã®ä¹–é›¢ã‚’æ¤œå‡ºãƒ»è¡¨ç¤º:
     a. ref ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ï¼ˆâŒï¼‰
     b. ref ã«ã‚ã£ã¦ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ï¼ˆâš ï¸ï¼‰
     c. ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚ã£ã¦ ref ãªã—ï¼ˆâš ï¸ï¼‰

  ### Task 4: trace ã‚³ãƒãƒ³ãƒ‰ã®æ‹¡å¼µï¼ˆSPEC-020ï¼‰
  **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/spec_weaver/cli.py`
  **è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
  - `--show-impl` (bool, default: False): å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ„ãƒªãƒ¼è¡¨ç¤º
  - `--extensions TEXT` (str, default: None): ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ£ãƒ³æ‹¡å¼µå­
  **å‡¦ç†**:
  - `_add_descendants_to_rich_node` ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
  - SPEC ãƒãƒ¼ãƒ‰ç›´ä¸‹ã« ğŸ“ï¼ˆref ç”±æ¥ï¼‰/ ğŸ“ï¼ˆannotation ã®ã¿ï¼‰ã‚’è¡¨ç¤º
  - ãƒ•ã‚¡ã‚¤ãƒ«ä¸åœ¨ã¯ âŒ ã§è¡¨ç¤º

  ### Task 5: ãƒ†ã‚¹ãƒˆã®è¿½åŠ 
  **ãƒ•ã‚¡ã‚¤ãƒ«**: `tests/test_impl_scanner.py`ï¼ˆæ–°è¦ï¼‰
  **å†…å®¹**:
  - get_ref_files ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆlist/string/ç©ºæ–‡å­—ã®å„å½¢å¼ï¼‰
  - ImplScanner.scan ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆå˜ä¸€ID, è¤‡æ•°ID, extensions ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
  **ãƒ•ã‚¡ã‚¤ãƒ«**: `tests/test_cli.py` or `tests/test_impl_link.py`ï¼ˆè¿½è¨˜ or æ–°è¦ï¼‰
  - audit --check-impl ã®ãƒ†ã‚¹ãƒˆ
  - trace --show-impl ã®ãƒ†ã‚¹ãƒˆ

  ### Task 6: dev-lifecycle ã‚¹ã‚­ãƒ«ã®æ›´æ–°
  **ãƒ•ã‚¡ã‚¤ãƒ«**: `.claude/skills/dev-lifecycle-skill/skill.md`
  **å†…å®¹**:
  Phase 4ï¼ˆå®Ÿè£…ï¼‰ã®æœ«å°¾ã«ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¿½åŠ :
  > #### å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã® ref è¨˜è¿°
  > ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸã‚‰ã€å¯¾è±¡ SPEC ã® YAML `ref` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«
  > å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ãƒªã‚¹ãƒˆå½¢å¼ã§è¨˜è¿°ã™ã‚‹ã“ã¨:
  > ```yaml
  > ref:
  >   - src/your_module.py
  > ```
  > ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨:
  > ```python
  > # implements: SPEC-XXX
  > ```

  ## ä¾å­˜é–¢ä¿‚
  Task 1 â†’ Task 2ï¼ˆimpl_scanner ãŒ doorstop ã«ä¾å­˜ï¼‰
  Task 1 â†’ Task 3ï¼ˆaudit ãŒ impl_scanner ã‚’ä½¿ã†ï¼‰
  Task 1 â†’ Task 4ï¼ˆtrace ãŒ impl_scanner ã‚’ä½¿ã†ï¼‰
  Task 3, Task 4 â†’ Task 5ï¼ˆãƒ†ã‚¹ãƒˆã¯å®Ÿè£…å¾Œï¼‰
  Task 1ã€œ5 â†’ Task 6ï¼ˆã‚¹ã‚­ãƒ«æ›´æ–°ã¯æœ€å¾Œï¼‰

  ## å®Œäº†æ¡ä»¶
  - uv run pytest tests/ -q ãŒå…¨ã¦é€šé
  - uv run spec-weaver audit --check-impl ./specification/features ãŒæ­£å¸¸çµ‚äº†
  - uv run spec-weaver trace SPEC-018 -f ./specification/features --show-impl ãŒæ­£å¸¸è¡¨ç¤º
  - uv run spec-weaver audit ./specification/features ãŒå¾“æ¥é€šã‚Šå‹•ä½œ
